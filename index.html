<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CS Space</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        /* üé® THEME VARIABLES SYSTEM */
        :root {
            --bg-body: #18181b; 
            --bg-mesh: radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.10) 0px, transparent 50%), 
                        radial-gradient(at 100% 0%, rgba(244, 63, 94, 0.10) 0px, transparent 50%);
            --sidebar-fixed: #27272a; 
            --card-bg: rgba(39, 39, 42, 0.65);
            --card-border: rgba(255, 255, 255, 0.08);
            --text-main: #f8fafc;
            --text-secondary: #94a3b8;
            --primary-color: #f97316;
            --primary-glow: rgba(249, 115, 22, 0.3);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --link-color: #38bdf8; 
            --font-main: 'Inter', 'Kanit', sans-serif;
            --radius-md: 12px; 
            --radius-lg: 16px;
        }

        [data-theme="light"] {
            --bg-body: #fdfaf6;
            --bg-mesh: radial-gradient(at 0% 0%, #fff7ed 0px, transparent 50%), 
                        radial-gradient(at 100% 0%, #ffedd5 0px, transparent 50%);
            --card-bg: rgba(255, 255, 255, 0.85);
            --card-border: #e2e8f0;
            --text-main: #0f172a;
            --text-secondary: #64748b;
            --primary-color: #ea580c;
            --link-color: #0284c7; 
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: var(--font-main);
            background-color: var(--bg-body);
            background-image: var(--bg-mesh);
            background-attachment: fixed;
            background-size: cover;
            margin: 0; padding: 0;
            color: var(--text-main);
            height: 100vh;
            overflow: hidden; 
            transition: background-color 0.3s;
        }

        .app-container { display: flex; flex-direction: column; height: 100vh; width: 100vw; }

        .sidebar {
            margin: 16px 24px 0 24px; 
            border-radius: 24px;
            height: 68px; 
            background: var(--sidebar-fixed); 
            border: 1px solid rgba(255,255,255,0.08);
            backdrop-filter: blur(12px);
            display: flex; flex-direction: row; align-items: center; justify-content: space-between;
            padding: 0 24px; flex-shrink: 0; z-index: 100; position: relative;
            color: #f8fafc; box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        
        .brand-area { font-size: 20px; font-weight: 700; color: #f8fafc; display: flex; align-items: center; gap: 6px; letter-spacing: -0.5px; white-space: nowrap; }
        .nav-group { display: flex; gap: 8px; align-items: center; }

        .nav-center {
            position: absolute; left: 50%; transform: translateX(-50%);
            display: flex; gap: 6px; background: rgba(0,0,0,0.2); padding: 4px; border-radius: 99px; border: 1px solid rgba(255,255,255,0.05);
        }

        .nav-btn {
            background: transparent; border: none; width: auto; 
            padding: 6px 16px; border-radius: 99px; 
            color: #94a3b8; font-family: var(--font-main); font-weight: 500; font-size: 13px; cursor: pointer;
            display: flex; align-items: center; gap: 8px; transition: all 0.2s; text-align: center;
        }
        .nav-btn:hover { color: #fff; background: rgba(255,255,255,0.05); }
        .nav-btn.active { background: var(--primary-color); color: white; box-shadow: 0 2px 10px var(--primary-glow); font-weight: 600; }

        .version-text { font-size: 11px; color: #64748b; font-weight: 500; margin-right: 12px; white-space: nowrap; }

        .icon-btn {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); width: 32px; height: 32px; border-radius: 50%;
            color: #cbd5e1; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; font-size: 15px;
        }
        .icon-btn:hover { background: rgba(255,255,255,0.15); color: #fff; transform: rotate(15deg); }

        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .content-scroll { flex: 1; overflow-y: auto; padding: 20px; }
        .compact-wrapper { max-width: 1250px; margin: 0 auto; width: 100%; }

        .page-header { margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; }
        .page-header h2 { font-size: 20px; font-weight: 700; margin: 0; letter-spacing: -0.5px; opacity: 0.9; }

        .page-view { display: none; animation: slideIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        .page-view.active { display: block; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .dashboard-controls {
            display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;
            background: var(--card-bg); padding: 12px; border-radius: var(--radius-md); border: 1px solid var(--card-border); align-items: center;
            backdrop-filter: blur(20px); box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        
        .crm-filter-group { display: flex; gap: 8px; margin-bottom: 10px; width: 100%; justify-content: center; }
        .crm-filter-btn {
            background: rgba(255,255,255,0.05); border: 1px solid var(--card-border); color: var(--text-secondary);
            padding: 8px 20px; border-radius: 8px; font-weight: 500; cursor: pointer; transition: 0.2s; font-size: 13px;
        }
        .crm-filter-btn:hover { background: rgba(255,255,255,0.1); color: var(--text-main); }
        .crm-filter-btn.active { background: var(--info); color: white; border-color: transparent; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); }

        .leaderboard-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-bottom: 20px; }
        
        #home-kpis { grid-template-columns: repeat(4, 1fr); }

        .lb-card { padding: 15px; border-radius: var(--radius-md); color: white; cursor: pointer; transition: transform 0.2s; position: relative; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.1); }
        .lb-card h3 { margin: 0 0 5px 0; font-size: 14px; }
        .lb-card .count { font-size: 24px; font-weight: 700; line-height: 1; }
        .lb-card:hover { transform: translateY(-3px); }
        
        .bg-gradient-1 { background: linear-gradient(135deg, #e11d48, #be123c); }
        .bg-gradient-2 { background: linear-gradient(135deg, #2563eb, #1d4ed8); }
        .bg-gradient-3 { background: linear-gradient(135deg, #ea580c, #c2410c); }
        .bg-gradient-4 { background: linear-gradient(135deg, #ca8a04, #a16207); color: #fff; }
        .bg-gradient-5 { background: linear-gradient(135deg, #eab308, #ca8a04); color: #fff; }
        
        .progress-track { background: rgba(0,0,0,0.2); height: 4px; width: 100%; border-radius: 4px; margin-top: 8px; overflow: hidden; }
        .progress-fill { background: rgba(255,255,255,0.9); height: 100%; border-radius: 4px; transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }

        .stats-row { display: grid; grid-template-columns: repeat(6, 1fr); gap: 12px; margin-bottom: 20px; }
        .stat-item { background: var(--card-bg); padding: 12px; border-radius: var(--radius-md); border: 1px solid var(--card-border); text-align: center; cursor: pointer; transition: 0.2s; backdrop-filter: blur(10px); }
        .stat-item:hover { border-color: var(--primary-color); transform: translateY(-2px); }
        .stat-item h4 { margin: 0; font-size: 10px; color: var(--text-secondary); text-transform: uppercase; font-weight: 700; }
        .stat-item .val { font-size: 22px; font-weight: 700; color: var(--text-main); margin-top: 4px; line-height: 1.2; }

        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .chart-card { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: var(--radius-lg); padding: 20px; height: 350px; display: flex; flex-direction: column; backdrop-filter: blur(10px); }
        .chart-title { font-size: 14px; font-weight: 600; color: var(--text-main); margin-bottom: 12px; }
        .chart-body { flex: 1; width: 100%; }

        .table-wrapper-center { max-width: 1250px; margin: 0 auto; width: 100%; }
        
        .table-container { 
            overflow-x: hidden; 
            background: var(--card-bg); 
            border-radius: var(--radius-lg); 
            border: 1px solid var(--card-border); 
            backdrop-filter: blur(10px); 
        }

        table { 
            width: 100%; 
            border-collapse: collapse; 
            font-size: 12px; 
            table-layout: fixed; 
        }

        th { 
            padding: 10px 8px; 
            text-align: left; 
            border-bottom: 1px solid var(--card-border);
            white-space: nowrap; 
            overflow: hidden;
            text-overflow: ellipsis; 
            vertical-align: middle;
        }

        td { 
            padding: 10px 8px; 
            text-align: left; 
            border-bottom: 1px solid var(--card-border);
            white-space: normal; 
            word-wrap: break-word;
            overflow-wrap: break-word;
            vertical-align: top;
        } 
        
        #mainTable th:nth-child(1) { width: 40px; text-align: center; } 
        #mainTable th:nth-child(2) { width: 70px; } 
        #mainTable th:nth-child(3) { width: 80px; } 
        #mainTable th:nth-child(4) { width: 14%; } 
        #mainTable th:nth-child(5) { width: 10%; } 
        #mainTable th:nth-child(6) { width: 18%; } 
        #mainTable th:nth-child(7) { width: 18%; } 
        #mainTable th:nth-child(8) { width: 80px; } 
        #mainTable th:nth-child(9) { width: 80px; } 
        #mainTable th:nth-child(10) { width: 110px; } 
        #mainTable th:nth-child(11) { width: 100px; } 

        #crmTable th:nth-child(1) { width: 40px; text-align: center; } 
        #crmTable th:nth-child(2) { width: 80px; } 
        #crmTable th:nth-child(3) { width: 100px; } 
        #crmTable th:nth-child(4) { width: 70px; text-align:center; } 
        #crmTable th:nth-child(5) { width: 14%; } 
        #crmTable th:nth-child(6) { width: 90px; } 
        #crmTable th:nth-child(7) { width: 14%; } 
        #crmTable th:nth-child(8) { width: 70px; text-align:right; } 
        #crmTable th:nth-child(9) { width: 80px; } 

        th { color: var(--text-secondary); font-weight: 600; text-transform: uppercase; font-size: 10px; letter-spacing: 0.5px; background: rgba(0,0,0,0.02); }
        tr:hover td { background: rgba(255,255,255,0.02); }
        [data-theme="light"] tr:hover td { background: rgba(0,0,0,0.02); }

        th:first-child, td:first-child { text-align: center; }

        .form-select, .form-input { width: 100%; height: 36px; padding: 0 10px; border-radius: 8px; border: 1px solid var(--card-border); background: rgba(255,255,255,0.03); color: var(--text-main); outline: none; font-family: var(--font-main); transition: 0.2s; font-size: 12px; }
        .form-select:focus, .form-input:focus { border-color: var(--primary-color); background: rgba(255,255,255,0.08); }
        [data-theme="light"] .form-select, .form-input { background: #f1f5f9; border-color: #cbd5e1; }
        
        .input-label { display: block; font-size: 10px; margin-bottom: 4px; color: var(--text-secondary); font-weight: 600; }
        
        .btn-primary { background: var(--primary-color); color: white; border: none; padding: 0 16px; height: 32px; border-radius: 99px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; box-shadow: 0 4px 12px var(--primary-glow); transition: 0.2s; font-size: 12px; }
        .btn-primary:hover { transform: translateY(-1px); filter: brightness(1.1); }
        .btn-outline { background: transparent; border: 1px solid var(--card-border); color: var(--text-secondary); padding: 0 10px; height: 32px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; font-size: 14px; }
        .btn-outline:hover { color: var(--text-main); border-color: var(--text-main); background: rgba(255,255,255,0.05); }

        .status-badge { padding: 4px 14px; border-radius: 99px; font-size: 11px; font-weight: 600; letter-spacing: 0.3px; white-space: nowrap; display: inline-block; }
        .status-closed { background: rgba(16, 185, 129, 0.1); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.2); }
        .status-doing { background: rgba(245, 158, 11, 0.1); color: #f59e0b; border: 1px solid rgba(245, 158, 11, 0.2); }
        .status-pending { background: rgba(148, 163, 184, 0.1); color: #94a3b8; border: 1px solid rgba(148, 163, 184, 0.2); }
        .status-assigned { background: rgba(59, 130, 246, 0.1); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.2); }
        .urgent-badge { width: 6px; height: 6px; border-radius: 50%; display: inline-block; margin-right: 4px; box-shadow: 0 0 4px currentColor; }

        .click-to-copy { cursor: pointer; text-decoration: none; transition: all 0.2s; color: var(--link-color); font-weight: 600; position: relative; }
        .click-to-copy:hover { text-decoration: underline; filter: brightness(1.2); }
        .copy-toast { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.9); color: #fff; padding: 10px 20px; border-radius: 99px; font-weight: 600; display: none; z-index: 10000; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 40px rgba(0,0,0,0.5); font-size: 13px; pointer-events: none; animation: slideUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes slideUp { from { transform: translate(-50%, 20px); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }

        .ticker-wrap { width: 100%; overflow: hidden; height: 32px; background: rgba(239, 68, 68, 0.08); border: 1px solid rgba(239, 68, 68, 0.15); border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; }
        .ticker-content { white-space: nowrap; padding-left: 100%; display: inline-block; animation: ticker 30s linear infinite; color: var(--danger); font-weight: 600; font-size: 12px; }
        @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        .mobile-search-row { display: flex; gap: 10px; margin-bottom: 15px; width: 100%; }
        .mobile-toggle-btn { display: none; white-space: nowrap; font-size: 12px; font-weight: 600; padding: 0 12px; }
        .filter-panel { display: flex; transition: all 0.3s ease; }
        .action-btn { width: 36px; flex-shrink: 0; }

        .dropdown { position: relative; display: inline-flex; }
        .dropdown-content {
            display: none; position: absolute; top: 110%; left: 50%; transform: translateX(-50%);
            background: var(--sidebar-fixed); padding: 8px; border-radius: var(--radius-lg);
            border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            min-width: 160px; flex-direction: column; gap: 4px; z-index: 1000;
        }
        
        .dropdown:hover .dropdown-content,
        .dropdown:focus-within .dropdown-content { 
            display: flex; 
            animation: popDown 0.2s cubic-bezier(0.16, 1, 0.3, 1); 
        }
        
        @keyframes popDown {
            from { opacity: 0; transform: translate(-50%, 10px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }
        [data-theme="light"] .dropdown-content { background: #ffffff; border-color: var(--card-border); }
        
        .dropdown-content .nav-btn { width: 100%; justify-content: center; border-radius: 8px; }
        
        .dropdown:has(.dropdown-content .nav-btn.active) .dropdown-trigger {
            background: var(--primary-color); color: white; box-shadow: 0 2px 10px var(--primary-glow); font-weight: 600;
        }

        @media (max-width: 1024px) {
            body { overflow: auto !important; height: auto !important; }
            .app-container { flex-direction: column; height: auto; min-height: 100vh; }
            .main-content { overflow: visible; height: auto; }
            
            .content-scroll { overflow: visible; height: auto; padding: 15px; padding-bottom: 90px; } 
            
            .sidebar { 
                height: auto; 
                flex-wrap: wrap; 
                padding: 12px 16px; 
                gap: 8px; 
                justify-content: space-between; 
                align-items: center;
                margin: 10px; 
                border-radius: 20px; 
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                background: transparent !important;
            }
            .sidebar::before {
                content: "";
                position: absolute;
                top: 0; left: 0; right: 0; bottom: 0;
                background: var(--sidebar-fixed);
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
                border-radius: inherit;
                z-index: -1;
            }
            .brand-area { margin-bottom: 0; width: auto; justify-content: flex-start; order: 1; }
            .sidebar > .nav-group:last-child { width: auto !important; margin-top: 0 !important; order: 2; }
            
            .nav-center { 
                position: fixed !important; 
                top: auto !important;
                bottom: 0 !important;
                left: 0 !important;
                width: 100% !important;
                background: rgba(39, 39, 42, 0.65) !important;
                backdrop-filter: blur(25px) saturate(180%) !important;
                -webkit-backdrop-filter: blur(25px) saturate(180%) !important;
                border: none !important;
                border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
                border-radius: 0 !important;
                padding: 10px 10px calc(10px + env(safe-area-inset-bottom)) 10px !important; 
                margin: 0 !important;
                justify-content: space-around !important; 
                align-items: center !important;
                z-index: 9999 !important;
                box-shadow: 0 -4px 30px rgba(0,0,0,0.3) !important;
                transform: none !important;
                flex-wrap: nowrap !important;
                flex-direction: row !important;
            }

            [data-theme="light"] .nav-center {
                background: rgba(255, 255, 255, 0.75) !important;
                border-top: 1px solid rgba(0, 0, 0, 0.1) !important;
            }
            
            .nav-btn { 
                width: auto; 
                flex: 1;
                background: transparent; 
                padding: 12px 4px;
                font-size: 13px;
                border-radius: 12px;
                justify-content: center;
                margin: 0 4px;
            }

            .dropdown { flex: 1; display: flex; justify-content: center; position: static; margin: 0 4px; }
            .dropdown .dropdown-trigger { width: 100%; margin: 0; }
            .dropdown-content { 
                top: auto; 
                bottom: calc(100% + 15px); 
                left: 50%;
                transform: translateX(-50%);
                width: calc(100% - 30px);
                max-width: 320px;
                border-radius: var(--radius-lg);
                box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
                padding: 10px;
            }
            
            .dropdown:hover .dropdown-content,
            .dropdown:focus-within .dropdown-content { 
                animation: popUpMobile 0.2s cubic-bezier(0.16, 1, 0.3, 1) forwards; 
                display: flex; 
            }

            .version-text { display: none; } 
            
            .compact-wrapper, .table-wrapper-center { width: 100%; max-width: 100%; }
            .summary-grid { grid-template-columns: 1fr; }
            .stats-row { grid-template-columns: repeat(2, 1fr); gap: 8px; }
            .crm-filter-group { flex-wrap: wrap; }
            .crm-filter-btn { flex: 1; text-align: center; white-space: nowrap; padding: 10px 12px; font-size: 13px;}
            
            #home-kpis { 
                grid-template-columns: repeat(2, 1fr) !important; 
                gap: 10px !important; 
                margin-bottom: 15px;
            }
            #home-kpis .stat-item { padding: 15px; }

            .leaderboard-row { 
                grid-template-columns: repeat(5, 1fr) !important; 
                gap: 4px !important; 
                margin-bottom: 15px;
            }
            .lb-card { padding: 8px 4px; text-align: center; }
            .lb-card h3 { font-size: 10px; margin-bottom: 2px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; }
            .lb-card .count { font-size: 15px; }
            .progress-label { font-size: 8px; margin-top: 3px; display: block; }
            .progress-track { margin-top: 4px; height: 3px; }

            .stat-item { padding: 10px; }
            .stat-item .val { font-size: 18px; }

            .mobile-toggle-btn { display: flex; align-items: center; justify-content: center; height: 40px;}
            .filter-panel { display: none; flex-direction: column; align-items: stretch; gap: 8px; margin-top: -5px; }
            .filter-panel.show { display: flex; animation: slideDownFilter 0.3s ease-out forwards; }
            .action-btn { width: 100% !important; justify-content: center; margin-top: 5px; height: 40px;}
            
            .dashboard-controls { padding: 12px 10px; flex-direction: column; gap: 8px; }
            .dashboard-controls > div { width: 100%; min-width: unset; }

            .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
            table { min-width: 1250px; font-size: 11px; } 
            
            .chart-card { height: 300px; padding: 10px; }
            .chart-body { height: 100%; }
        }

        @keyframes slideDownFilter {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes popUpMobile {
            from { opacity: 0; transform: translate(-50%, 15px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }

        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); z-index: 2000; display: none; align-items: center; justify-content: center; }
        .modal-overlay.open { display: flex; }
        .modal-box { background: var(--bg-body); border: 1px solid var(--card-border); width: 90%; max-width: 500px; border-radius: var(--radius-lg); padding: 20px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

<div id="copyToast" class="copy-toast">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!</div>

<div class="app-container">
    
    <nav class="sidebar">
        <div class="brand-area">
            <span style="color:var(--primary-color)">CS</span> Space <span id="brandPageTitle" style="font-size: 16px; color: var(--text-secondary); font-weight: 500; margin-left: 4px;">| OPS101</span>
        </div>
        
        <div class="nav-group nav-center">
            <button class="nav-btn" onclick="switchPage('home', this)">Home</button>
            <div class="dropdown">
                <button class="nav-btn dropdown-trigger active" onclick="void(0)" tabindex="0">CS+</button>
                <div class="dropdown-content">
                    <button class="nav-btn active" onclick="switchPage('dashboard', this)">OPS101</button>
                    <button class="nav-btn" onclick="switchPage('crm', this)">CRM201</button>
                    <button class="nav-btn" onclick="switchPage('tec', this)">TEC301</button>
                    <button class="nav-btn" onclick="switchPage('summary', this)">CS Summary</button>
                </div>
            </div>
            <button class="nav-btn" onclick="switchPage('installq', this)">Install Q+</button>
        </div>
        <div class="nav-group" style="gap:10px; justify-content: flex-end; width:100%; margin-top:5px;">
            <span id="countdown" class="version-text">v.0.7.10 Beta ‚Ä¢ Loading...</span>
            <button class="btn-primary" onclick="openModal()">+</button>
            <button class="icon-btn" onclick="toggleTheme()" title="‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î">‚úπ</button>
        </div>
    </nav>

    <main class="main-content">
        <div class="content-scroll">
            <div id="urgentTicker" class="ticker-wrap" style="display:none;">
                <div class="ticker-content" id="tickerContent"></div>
            </div>

            <div id="view-home" class="page-view">
                <div class="page-header" style="justify-content: flex-start;">
                    
                </div>
                
                <div class="compact-wrapper">
                    <div style="display:flex; align-items:center; gap:10px; margin-bottom: 12px;">
                        <h3 style="font-size: 16px; margin:0; color: var(--text-main);">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡πÄ‡∏Ñ‡∏™‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå</h3>
                    </div>
                    
                    <div class="leaderboard-row" id="home-kpis"></div>

                    <div class="summary-grid" style="margin-top: 20px;">
                        <div class="chart-card">
                            <div class="chart-title">üö® ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÄ‡∏à‡∏≠‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (Top Issues)</div>
                            <div id="chart_home_issue_div" class="chart-body"></div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-title">üìà ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (‡∏ô‡∏≤‡∏ó‡∏µ)</div>
                            <div id="chart_home_resp_div" class="chart-body"></div>
                        </div>
                    </div>

                    <div style="margin-top: 25px;">
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom: 12px;">
                            <h3 style="font-size: 16px; margin:0; color: var(--danger);">üî• ‡πÄ‡∏Ñ‡∏™‡∏î‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å ‡πÅ‡∏•‡∏∞ ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà</h3>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th style="width: 70px;">Ticket</th>
                                        <th style="width: 20%;">Customer</th>
                                        <th style="width: 30%;">Issue</th>
                                        <th style="width: 100px;">Urgency</th>
                                        <th style="width: 80px;">Owner</th>
                                        <th style="width: 110px;">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="homeUrgentBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div id="view-dashboard" class="page-view active">
                <div class="compact-wrapper">
                    <div class="leaderboard-row" id="leaderboard"></div>
                    <div class="stats-row">
                        <div class="stat-item" onclick="filterStatus('total-all')"><h4>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4><div class="val" id="val-total">0</div></div>
                        <div class="stat-item" onclick="filterStatus('all')"><h4>‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h4><div class="val" id="val-active" style="color:var(--primary-color)">0</div></div>
                        <div class="stat-item" onclick="filterStatus('‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£')"><h4>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h4><div class="val" id="val-pending">0</div></div>
                        <div class="stat-item" onclick="filterStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£')"><h4>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h4><div class="val" id="val-doing">0</div></div>
                        <div class="stat-item" onclick="filterStatus('‡∏õ‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™')"><h4>‡∏õ‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™</h4><div class="val" id="val-closed" style="color:var(--success)">0</div></div>
                        <div class="stat-item" onclick="filterStatus('‡∏û‡∏¥‡πÄ‡∏®‡∏©')"><h4>‡∏û‡∏¥‡πÄ‡∏®‡∏©</h4><div class="val" id="val-special" style="color:var(--danger)">0</div></div>
                    </div>
                    
                    <div class="mobile-search-row">
                        <input type="text" id="searchInput" class="form-input" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Ticket, ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤..." onkeyup="renderTable()" style="flex:1;">
                        <button class="btn-outline mobile-toggle-btn" onclick="document.getElementById('opsFilterPanel').classList.toggle('show')">‚öôÔ∏è Filter ‚ñæ</button>
                    </div>
                    
                    <div class="dashboard-controls filter-panel" id="opsFilterPanel">
                        <div style="flex:1; min-width:130px;"><input type="date" id="dateFilter" class="form-input" onchange="renderTable()"></div>
                        <div style="flex:1; min-width:130px;">
                            <select id="statusFilter" class="form-select" onchange="renderTable()">
                                <option value="total-all">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                                <option value="all" selected>‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</option>
                                <option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                                <option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                                <option value="‡∏õ‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™">‡∏õ‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™</option>
                                <option value="‡∏û‡∏¥‡πÄ‡∏®‡∏©">‡∏û‡∏¥‡πÄ‡∏®‡∏©</option>
                            </select>
                        </div>
                        <div style="flex:1; min-width:130px;">
                            <select id="csFilter" class="form-select" onchange="renderTable()">
                                <option value="all">‡∏ó‡∏µ‡∏°: ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                                <option value="Best">Best</option>
                                <option value="Friend">Friend</option>
                                <option value="Ball">Ball</option>
                                <option value="Ohm">Ohm</option>
                                <option value="Tar">Tar</option>
                            </select>
                        </div>
                        <button class="btn-outline action-btn" onclick="resetFilters()" title="‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï">‚Ü∫</button>
                        <button class="btn-outline action-btn" onclick="exportCSV()" title="Export CSV">üì•</button>
                    </div>
                    </div>
                <div class="table-wrapper-center">
                    <div class="table-container">
                        <table id="mainTable">
                            <thead>
                                <tr>
                                    <th>#</th><th>Ticket</th><th>Date</th><th>Customer</th><th>Model / Type</th>
                                    <th>Issue</th><th>Solution</th><th>CS Name</th><th>Urgency</th><th>Status</th><th>Assignee</th> 
                                </tr>
                            </thead>
                            <tbody id="tableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div id="view-crm" class="page-view">
                <div class="page-header"><h2>CRM201 : ‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡πÇ‡∏ó‡∏£‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</h2></div>
                <div class="compact-wrapper">
                    
                    <div class="crm-filter-group">
                        <button class="crm-filter-btn active" onclick="setCRMFilter(7, this)">‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î 7 ‡∏ß‡∏±‡∏ô</button>
                        <button class="crm-filter-btn" onclick="setCRMFilter(30, this)">‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î 30 ‡∏ß‡∏±‡∏ô</button>
                        <button class="crm-filter-btn" onclick="setCRMFilter(60, this)">‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î 60 ‡∏ß‡∏±‡∏ô</button>
                        <button class="crm-filter-btn" onclick="setCRMFilter('all', this)">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    </div>

                    <div class="mobile-search-row">
                        <input type="text" id="crmSearch" class="form-input" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£..." onkeyup="resetCRMAndRender()" style="flex:1;">
                        <button class="btn-outline mobile-toggle-btn" onclick="document.getElementById('crmFilterPanel').classList.toggle('show')">‚öôÔ∏è Filter ‚ñæ</button>
                    </div>
                    
                    <div class="dashboard-controls filter-panel" id="crmFilterPanel">
                        <div style="flex:1; min-width:130px;">
                            <select id="crmOwnerFilter" class="form-select" onchange="resetCRMAndRender()">
                                <option value="all">‡∏î‡∏π‡πÅ‡∏•‡πÇ‡∏î‡∏¢: ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                                <option value="Best">Best</option>
                                <option value="Friend">Friend</option>
                                <option value="Ball">Ball</option>
                                <option value="Ohm">Ohm</option>
                                <option value="Tar">Tar</option>
                            </select>
                        </div>
                        <div style="flex:0 0 150px;">
                            <div class="stat-item" style="padding:4px 12px; height:36px; display:flex; align-items:center; justify-content:center; gap:8px;">
                                <h4 style="margin:0;">List Count</h4>
                                <div class="val" id="crm-total" style="font-size:16px; margin:0;">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="table-wrapper-center">
                        <div class="table-container">
                            <table id="crmTable">
                                <thead>
                                    </thead>
                                <tbody id="crmBody"></tbody>
                            </table>
                        </div>
                        <div style="text-align:center; margin-top:15px; margin-bottom:10px;">
                            <button id="crmLoadMoreBtn" class="btn-outline" style="width:auto; padding:8px 20px; display:none; margin:0 auto;" onclick="loadMoreCRM()">‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-tec" class="page-view">
                <div class="page-header"><h2>TEC301</h2></div>
                <div class="compact-wrapper" style="display:flex; justify-content:center; align-items:center; height:300px; color:var(--text-secondary);">
                    <div style="text-align:center;">
                        <div style="font-size:40px; margin-bottom:10px;">üõ†Ô∏è</div>
                        <div>Coming Soon</div>
                    </div>
                </div>
            </div>

            <div id="view-installq" class="page-view">
                <div class="page-header">
                    <h2>Install Q+ <span style="font-size: 14px; font-weight: normal; color: var(--text-secondary); margin-left: 10px;">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏¥‡∏ß‡∏á‡∏≤‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á</span></h2>
                </div>
                <div class="compact-wrapper">
                    
                    <div class="dashboard-controls" style="margin-bottom: 25px;">
                        <div style="flex:1; min-width:150px;">
                            <label class="input-label">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                            <input type="date" id="installDateFilter" class="form-input" onchange="renderInstall()">
                        </div>
                        <div style="flex:1; min-width:150px;">
                            <label class="input-label">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
                            <input type="text" id="installSearch" class="form-input" placeholder="üîç ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." onkeyup="renderInstall()">
                        </div>
                        <div style="flex:1; min-width:150px;">
                            <label class="input-label">‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</label>
                            <select id="installTeamFilter" class="form-select" onchange="renderInstall()">
                                <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                                <option value="Boom">Boom</option>
                                <option value="Ohm">Ohm / Tar</option>
                                <option value="Best">Best / Ball</option>
                            </select>
                        </div>
                    </div>

                    <div style="margin-bottom: 24px; position: relative;">
                        <h3 style="font-size: 16px; margin: 0 0 12px 10px; color: var(--primary-color); border-left: 4px solid var(--primary-color); padding-left: 8px;">üìç ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£)</h3>
                        <div id="installMap" style="height: 350px; width: 100%; border-radius: var(--radius-lg); border: 1px solid var(--card-border); z-index: 1; background: var(--card-bg);"></div>
                        <div id="mapWarning" style="font-size: 11px; color: var(--warning); margin-top: 8px; margin-left: 10px; display: none;">* ‡∏ö‡∏≤‡∏á‡∏´‡∏°‡∏∏‡∏î‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• ‡∏´‡∏≤‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå Location ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏¢‡πà‡∏≠ (Short Link) ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏¥‡∏Å‡∏±‡∏î (Lat/Lng) ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô</div>
                    </div>

                    <div style="margin-bottom: 24px;">
                        <h3 style="font-size: 16px; margin: 0 0 12px 10px; color: #ff4d4d; border-left: 4px solid #ff4d4d; padding-left: 8px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h3>
                        <div class="table-container">
                            <table id="installRunningTable">
                                <thead>
                                    <tr>
                                        <th style="width: 80px;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                        <th style="width: 15%;">‡∏£‡∏´‡∏±‡∏™‡∏á‡∏≤‡∏ô</th>
                                        <th style="width: 15%;">Location</th>
                                        <th style="width: 12%;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</th>
                                        <th style="width: 15%;">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</th>
                                        <th style="width: 12%;">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡πâ‡∏≥</th>
                                        <th style="width: 10%;">‡∏ó‡∏µ‡∏°‡∏ä‡πà‡∏≤‡∏á</th>
                                        <th style="width: 10%;">‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</th>
                                        <th style="width: 100px;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <div style="margin-bottom: 24px;">
                        <h3 style="font-size: 16px; margin: 0 0 12px 10px; color: #10b981; border-left: 4px solid #10b981; padding-left: 8px;">‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏°‡πÅ‡∏•‡πâ‡∏ß</h3>
                        <div class="table-container">
                            <table id="installConfirmTable">
                                <thead>
                                    <tr>
                                        <th style="width: 80px;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                        <th style="width: 15%;">‡∏£‡∏´‡∏±‡∏™‡∏á‡∏≤‡∏ô</th>
                                        <th style="width: 15%;">Location</th>
                                        <th style="width: 12%;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</th>
                                        <th style="width: 15%;">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</th>
                                        <th style="width: 12%;">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡πâ‡∏≥</th>
                                        <th style="width: 10%;">‡∏ó‡∏µ‡∏°‡∏ä‡πà‡∏≤‡∏á</th>
                                        <th style="width: 10%;">‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</th>
                                        <th style="width: 100px;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <div style="margin-bottom: 24px;">
                        <h3 style="font-size: 16px; margin: 0 0 12px 10px; color: #3b82f6; border-left: 4px solid #3b82f6; padding-left: 8px;">‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</h3>
                        <div class="table-container">
                            <table id="installBookingTable">
                                <thead>
                                    <tr>
                                        <th style="width: 80px;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                        <th style="width: 15%;">‡∏£‡∏´‡∏±‡∏™‡∏á‡∏≤‡∏ô</th>
                                        <th style="width: 15%;">Location</th>
                                        <th style="width: 12%;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</th>
                                        <th style="width: 15%;">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</th>
                                        <th style="width: 12%;">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡πâ‡∏≥</th>
                                        <th style="width: 10%;">‡∏ó‡∏µ‡∏°‡∏ä‡πà‡∏≤‡∏á</th>
                                        <th style="width: 10%;">‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</th>
                                        <th style="width: 100px;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <div style="margin-bottom: 24px;">
                        <h3 style="font-size: 16px; margin: 0 0 12px 10px; color: #94a3b8; border-left: 4px solid #94a3b8; padding-left: 8px;">‡∏Ñ‡∏¥‡∏ß‡∏ß‡πà‡∏≤‡∏á</h3>
                        <div class="table-container">
                            <table id="installAvailableTable">
                                <thead>
                                    <tr>
                                        <th style="width: 80px;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                        <th style="width: 15%;">‡∏£‡∏´‡∏±‡∏™‡∏á‡∏≤‡∏ô</th>
                                        <th style="width: 15%;">Location</th>
                                        <th style="width: 12%;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</th>
                                        <th style="width: 15%;">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</th>
                                        <th style="width: 12%;">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡πâ‡∏≥</th>
                                        <th style="width: 10%;">‡∏ó‡∏µ‡∏°‡∏ä‡πà‡∏≤‡∏á</th>
                                        <th style="width: 10%;">‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</th>
                                        <th style="width: 100px;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>
            
            <div id="view-summary" class="page-view">
                <div class="page-header"><h2>‡∏Å‡∏£‡∏≤‡∏ü‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á CS:OPS101</h2></div>
                <div class="compact-wrapper">
                    <div class="summary-grid">
                        <div class="chart-card"><div class="chart-title">üèÜ 10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div><div id="chart_div" class="chart-body"></div></div>
                        <div class="chart-card"><div class="chart-title">üì¶ 10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div><div id="chart_type_div" class="chart-body"></div></div>
                        <div class="chart-card"><div class="chart-title">üî• ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏™</div><div id="chart_urgent_div" class="chart-body"></div></div>
                        <div class="chart-card"><div class="chart-title">‚≠ê ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div><div id="chart_csat_div" class="chart-body"></div></div>
                        <div class="chart-card" style="grid-column: span 1;"><div class="chart-title">‚è±Ô∏è ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å (‡∏Ñ‡∏ô/‡∏ô‡∏≤‡∏ó‡∏µ)</div><div id="chart_resp_div" class="chart-body"></div></div>
                    </div>
                </div>
            </div>

        </div>
    </main>
</div>

<div class="modal-overlay" id="addModal">
    <div class="modal-box">
        <h2 style="margin-top:0;">üìÇ ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™‡πÉ‡∏´‡∏°‡πà</h2>
        <form id="ticketForm" style="display:flex; flex-direction:column; gap:12px;">
            <div><label class="input-label">CS Name (‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö)</label>
            <select name="owner" class="form-select" required>
                <option value="Best">Best</option>
                <option value="Friend">Friend</option>
                <option value="Ball">Ball</option>
                <option value="Ohm">Ohm</option>
                <option value="Tar">Tar</option>
            </select></div>
            <div><label class="input-label">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label><input name="customerName" class="form-input" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤..."></div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <div><label class="input-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label><select name="type" class="form-select"><option value="ICE">ICE</option><option value="COFFEE">COFFEE</option><option value="FUME">FUME</option><option value="BLENDER">BLENDER</option><option value="SODA">SODA</option><option value="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡πâ‡∏≥">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡πâ‡∏≥</option><option value="‡∏õ‡∏±‡πä‡∏°‡∏î‡∏π‡∏î‡∏ô‡πâ‡∏≥‡∏à‡∏≤‡∏Å‡∏ñ‡∏±‡∏á">‡∏õ‡∏±‡πä‡∏°‡∏î‡∏π‡∏î‡∏ô‡πâ‡∏≥‡∏à‡∏≤‡∏Å‡∏ñ‡∏±‡∏á</option><option value="‡∏ï‡∏π‡πâ‡πÅ‡∏ä‡πà‡∏ô‡∏°">‡∏ï‡∏π‡πâ‡πÅ‡∏ä‡πà‡∏ô‡∏°</option></select></div>
                <div><label class="input-label">‡∏£‡∏∏‡πà‡∏ô</label><select name="model" class="form-select">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∏‡πà‡∏ô --</option><option value="12A">12A</option><option value="12B">12B</option><option value="12C">12C</option><option value="15AF">15AF</option><option value="RoG600">RoG600</option><option value="S72C">S72C</option><option value="006C/H">006C/H</option><option value="S9C">S9C</option><option value="07S">07S</option><option value="38F">38F</option><option value="20AF">20AF</option><option value="120F">120F</option><option value="13F-W">13F-W</option><option value="P3B">P3B</option><option value="ProSoda">ProSoda</option><option value="Pro soda max">Pro soda max</option><option value="65S">65S</option><option value="45F">45F</option><option value="ROA4">ROA4</option><option value="U5">U5</option><option value="13F-PS">13F-PS</option><option value="220F">220F</option><option value="700xj">700xj</option><option value="FE 401">FE 401</option><option value="15SA">15SA</option><option value="13F-WB">13F-WB</option><option value="190F">190F</option><option value="20YLR">20YLR</option><option value="Blender">Blender</option><option value="ro-g600">ro-g600</option><option value="M7A">M7A</option><option value="RoA4">RoA4</option><option value="9CN">9CN</option><option value="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏≠‡∏Å‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏≠‡∏Å‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå</option>
                </select></div>
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <div><label class="input-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πà‡∏ß‡∏ô</label><select name="urgency" class="form-select"><option value="3.‡πÑ‡∏°‡πà‡∏£‡∏µ‡∏ö">‡∏õ‡∏Å‡∏ï‡∏¥</option><option value="2.‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option><option value="1.‡∏î‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å">üî• ‡∏î‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å</option></select></div>
                <div><label class="input-label">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á</label><select name="channel" class="form-select"><option value="Line OA">Line OA</option><option value="Facebook">Facebook</option><option value="Shopee">Shopee</option><option value="‡πÇ‡∏ó‡∏£">‡πÇ‡∏ó‡∏£</option></select></div>
            </div>
            <div><label class="input-label">‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢</label><textarea name="issue" class="form-input" style="height:70px; padding-top:10px;"></textarea></div>
            <div><label class="input-label">‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</label><textarea name="solution" class="form-input" style="height:50px; padding-top:10px;"></textarea></div>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button type="submit" class="btn-primary" style="flex:1; justify-content:center;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                <button type="button" class="btn-outline" style="flex:1; justify-content:center;" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </form>
    </div>
</div>

<script>
    google.charts.load('current', {'packages':['corechart']});
    
    // --- CONFIGS ---
    const MAIN_SHEET_ID = '1yP4soDSWwjomPVP3_udd2m3SZlm5j5XVo32tbKGvwdA', MAIN_GID = '816388223';
    // CRM Sheet Configuration
    const CRM_SHEET_ID = '1hJFF9j0fKoc-weDht_BWzhMfW7eTkZC6YQcIj36Pw58', CRM_GID = '1809457353';
    
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzDRJpLUw51hZi3WI6Su7_LgeXz0GG-bK4CtfGygkmbfne2dMdtbVAVjD0NDmuEaL8v/exec';

    let allTickets = [], filteredExport = [];
    let allCRM = []; // Store CRM data
    let currentCRMFilter = 7; // Default to 7 days
    let crmLimit = 10; // CRM: Limit items per load
    let allInstalls = []; // Store Install Q+ data

    let countdownSec = 300;
    const savedTheme = localStorage.getItem('cs_theme') || 'dark';
    document.documentElement.setAttribute('data-theme', savedTheme);

    // üó∫Ô∏è ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
    let installMap = null;
    let markersLayer = null;

    function toggleTheme() {
        const next = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next); localStorage.setItem('cs_theme', next);
        drawChart(allTickets);
    }

    function switchPage(pageId, btn) {
        document.querySelectorAll('.page-view').forEach(p => p.classList.remove('active'));
        document.getElementById('view-' + pageId).classList.add('active');
        
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');

        // üî• Save Last Page to Local Storage
        localStorage.setItem('cs_last_page', pageId);
        
        const titles = {
            'home': 'Home',
            'dashboard': 'OPS101', 
            'crm': 'CRM201', 
            'tec': 'TEC301', 
            'installq': 'Install Q+',
            'summary': 'CS Summary'
        };
        
        // üî• ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà üî•
        const titleEl = document.getElementById('brandPageTitle');
        if(titleEl) titleEl.innerText = `| ${titles[pageId]}`;

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏≤‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ Summary ‡∏´‡∏£‡∏∑‡∏≠ Home
        if(pageId === 'summary' || pageId === 'home') setTimeout(() => drawChart(allTickets), 100); 

        // üó∫Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏´‡πâ Leaflet ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤ (‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡πä‡∏Å‡∏†‡∏≤‡∏û‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡∏≤)
        if(pageId === 'installq' && installMap) {
            setTimeout(() => installMap.invalidateSize(), 300);
        }
    }

    function openModal() { document.getElementById('addModal').classList.add('open'); }
    function closeModal() { document.getElementById('addModal').classList.remove('open'); }
    function filterStatus(s) { document.getElementById('statusFilter').value = s; renderTable(); }
    
    function resetFilters() {
        document.getElementById('dateFilter').value = '';
        document.getElementById('statusFilter').value = 'all'; document.getElementById('csFilter').value = 'all';
        document.getElementById('searchInput').value = '';
        renderTable();
    }

    // CRM SPECIFIC FUNCTIONS
    function resetCRMAndRender() {
        crmLimit = 10;
        renderCRMTable();
    }

    function loadMoreCRM() {
        crmLimit += 10;
        renderCRMTable();
    }

    function copyText(text) {
        navigator.clipboard.writeText(text).then(() => {
            const t = document.getElementById('copyToast'); t.style.display = 'block'; 
            setTimeout(() => t.style.display = 'none', 2000);
        });
    }
    
    function formatLink(text) {
        if (!text || text === '-') return '-';
        text = String(text);
        if (text.toLowerCase().startsWith('http') || text.toLowerCase().startsWith('www')) {
            const url = text.toLowerCase().startsWith('www') ? 'http://' + text : text;
            return `<a href="${url}" target="_blank" style="color:var(--link-color); text-decoration:underline;">‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå</a>`;
        }
        return text;
    }

    setInterval(() => {
        if(countdownSec > 0) {
            countdownSec--;
            let m = Math.floor(countdownSec/60).toString().padStart(2,'0'), s = (countdownSec%60).toString().padStart(2,'0');
            document.getElementById('countdown').innerText = `v.0.7.10 Beta ‚Ä¢ ${m}:${s}`;
        } else location.reload();
    }, 1000);

    // --- FETCH MAIN DATA (OPS101) ---
    const script1 = document.createElement('script');
    script1.src = `https://docs.google.com/spreadsheets/d/${MAIN_SHEET_ID}/gviz/tq?tqx=responseHandler:handleData&gid=${MAIN_GID}`;
    document.body.appendChild(script1);

    // --- FETCH CRM DATA (CRM201) ---
    const script2 = document.createElement('script');
    script2.src = `https://docs.google.com/spreadsheets/d/${CRM_SHEET_ID}/gviz/tq?tqx=responseHandler:handleCRM&gid=${CRM_GID}`;
    document.body.appendChild(script2);

    // --- FETCH INSTALL Q+ DATA ---
    const INSTALL_SHEET_ID = '1eQPV2iY_l7dW22DnFqFXcx3R0i9sfkua8Gxw2eC901Y';
    const INSTALL_GID = '1567272905';
    const scriptInstall = document.createElement('script');
    scriptInstall.src = `https://docs.google.com/spreadsheets/d/${INSTALL_SHEET_ID}/gviz/tq?tqx=responseHandler:handleInstall&gid=${INSTALL_GID}`;
    document.body.appendChild(scriptInstall);

    // Callback for OPS101
    window.handleData = (json) => {
        const rows = json.table.rows;
        allTickets = rows.map(r => {
            const v = (i) => (r.c[i] ? (r.c[i].f || r.c[i].v) : "-");
            return {
                id: v(0), date: v(1), owner: v(2), urgent: v(3), status: v(4), assignee: v(5),
                channel: v(6), customer: v(11), issue: v(20), solution: v(13), model: v(15), type: v(14),
                satisfaction: v(18), responseTime: v(19)
            };
        }).filter(x => x.id !== 'Ticket ID' && x.id !== '-');

        allTickets.sort((a,b) => {
            const getU = (val) => {
                let v = String(val || "");
                if (v.includes("1")) return 1;
                if (v.includes("2") || v.includes("‡∏û‡∏¥‡πÄ‡∏®‡∏©")) return 2;
                if (v.includes("3")) return 3;
                return 99;
            };
            const sMap = {'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£':1, '‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢':2, '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£':3, '‡∏õ‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™':4};
            if(getU(a.urgent) !== getU(b.urgent)) return getU(a.urgent) - getU(b.urgent);
            return (sMap[a.status]||99) - (sMap[b.status]||99);
        });
        updateDashboard(); 
        updateHome(); // üî• ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤ Home 
        renderTable();
        
        // üî• FIX: ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à
        if (typeof google !== 'undefined' && google.visualization) {
            drawChart(allTickets);
        }
    };

    // Callback for CRM201
    window.handleCRM = (json) => {
        const rows = json.table.rows;
        allCRM = rows.map(r => {
            const v = (i) => (r.c[i] ? (r.c[i].f || r.c[i].v) : "-");
            return {
                date: v(0), platform: v(1), name: v(2), phone: v(3), items: v(4), 
                total: v(5), address: v(6), province: v(7), tracking: v(8),
                owner: v(11), // Column L (Index 11) -> Owner/Officer
                done7: v(12),  
                colP: v(15), colQ: v(16), // 7 Days Data (P,Q)
                done30: v(19), 
                colU: v(20), colV: v(21), // 30 Days Data (U,V)
                done60: v(24),
                colZ: v(25), colAA: v(26) // 60 Days Data (Z,AA)
            };
        }).filter(x => x.date !== '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤' && x.name !== '-');
        
        renderCRMTable();
    };

    // Callback ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Install Q+
    window.handleInstall = (json) => {
        const rows = json.table.rows;
        allInstalls = rows.map(r => {
            const v = (i) => (r.c[i] ? (r.c[i].f || r.c[i].v) : "-");
            return {
                date: v(0),       // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà)
                customer: v(1),   // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå B (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà)
                task: v(2),       // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå C (‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥)
                team: v(3),       // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå D (‡∏ó‡∏µ‡∏°‡∏ä‡πà‡∏≤‡∏á)
                status: v(4),     // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå E (‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞)
                operator: v(8),   // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå I (‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô)
                waterFilter: v(13),// ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå N (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡πâ‡∏≥)
                mainProduct: v(15),// ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå P (‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å)
                location: v(19)   // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå T (Location)
            };
        }).filter(x => x.date !== '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà' && x.date !== '-'); // ‡∏Ç‡πâ‡∏≤‡∏° Header
        
        renderInstall();
    };

    // üó∫Ô∏è ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏¥‡∏ß‡∏á‡∏≤‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
    function updateInstallMap(runningData) {
        if (!installMap) {
            // ‡πÄ‡∏ã‡πá‡∏ï‡∏à‡∏∏‡∏î‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø)
            installMap = L.map('installMap').setView([13.7563, 100.5018], 10);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(installMap);
            markersLayer = L.layerGroup().addTo(installMap);
        }

        markersLayer.clearLayers();
        let bounds = [];
        let unmappedCount = 0;

        runningData.forEach(t => {
            let loc = String(t.location || "");
            if (loc === '-' || loc === '') return;

            // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡∏∞ Lat/Lng ‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå Google Maps ‡∏´‡∏•‡∏≤‡∏¢‡πÜ ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö
            let lat = null, lng = null;
            const regexAt = /@(-?\d+\.\d+),(-?\d+\.\d+)/;
            const regexQ = /q=(-?\d+\.\d+),(-?\d+\.\d+)/;
            const regexLl = /ll=(-?\d+\.\d+),(-?\d+\.\d+)/;

            let match = loc.match(regexAt) || loc.match(regexQ) || loc.match(regexLl);

            if (match) {
                lat = parseFloat(match[1]);
                lng = parseFloat(match[2]);
            } else {
                unmappedCount++; // ‡∏ñ‡πâ‡∏≤‡∏´‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡πÄ‡∏ä‡πà‡∏ô‡πÄ‡∏õ‡πá‡∏ô goo.gl ‡∏™‡∏±‡πâ‡∏ô‡πÜ
                return;
            }

            if (lat && lng) {
                let marker = L.marker([lat, lng]).bindPopup(`
                    <div style="font-family: var(--font-main); font-size: 13px;">
                        <strong style="color:var(--primary-color)">${t.customer}</strong><br>
                        ‡∏á‡∏≤‡∏ô: ${t.task}<br>
                        ‡∏ä‡πà‡∏≤‡∏á: ${t.team} (${t.operator})<br>
                        <a href="${loc}" target="_blank" style="display:inline-block; margin-top:8px; color:var(--link-color);">üó∫Ô∏è ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á Google Maps</a>
                    </div>
                `);
                markersLayer.addLayer(marker);
                bounds.push([lat, lng]);
            }
        });

        // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏°‡∏∏‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏´‡∏°‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        if (bounds.length > 0) {
            installMap.fitBounds(bounds, { padding: [30, 30], maxZoom: 15 });
        } else {
            installMap.setView([13.7563, 100.5018], 10); // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏∏‡∏î
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏´‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
        const warningEl = document.getElementById('mapWarning');
        if (warningEl) {
            if (unmappedCount > 0) {
                warningEl.innerText = `* ‡∏°‡∏µ ${unmappedCount} ‡∏Ñ‡∏¥‡∏ß‡∏á‡∏≤‡∏ô ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ (‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå Location ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏¢‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏¥‡∏Å‡∏±‡∏î X,Y)`;
                warningEl.style.display = 'block';
            } else {
                warningEl.style.display = 'none';
            }
        }

        setTimeout(() => { installMap.invalidateSize(); }, 300);
    }

    function setCRMFilter(days, btn) {
        currentCRMFilter = days;
        document.querySelectorAll('.crm-filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        resetCRMAndRender();
    }

    function calculateDueDate(dateStr, daysToAdd) {
        if (!dateStr) return null;
        const d = parseDateObj(dateStr);
        if (!d) return null;
        d.setDate(d.getDate() + parseInt(daysToAdd));
        return d;
    }

    function parseDateObj(str) {
        if (!str || str === '-') return null;
        str = String(str).trim(); 
        let d, m, y;
        if (str.toLowerCase().startsWith('date(')) {
            const nums = str.match(/\d+/g);
            if (nums && nums.length >= 3) { y = parseInt(nums[0]); m = parseInt(nums[1]) + 1; d = parseInt(nums[2]); }
        } else {
            const parts = str.split(' ')[0].split(/[\/\-\.]/);
            if (parts.length === 3) {
                if (parseInt(parts[0]) > 31) { y = parseInt(parts[0]); m = parseInt(parts[1])-1; d = parseInt(parts[2]); } 
                else { d = parseInt(parts[0]); m = parseInt(parts[1])-1; y = parseInt(parts[2]); }
            } else return null;
        }
        if (y > 2400) y -= 543;
        return new Date(y, m, d);
    }

    function formatDate(dateObj) {
        if (!dateObj) return "-";
        return `${dateObj.getFullYear()}-${String(dateObj.getMonth()+1).padStart(2,'0')}-${String(dateObj.getDate()).padStart(2,'0')}`;
    }

    function renderCRMTable() {
        const thead = document.querySelector('#crmTable thead');
        const tbody = document.getElementById('crmBody'); 
        tbody.innerHTML = '';
        
        const ownerFilter = document.getElementById('crmOwnerFilter').value;

        // 1. HEADER LOGIC (ADDED Products, Total, Province to ALL VIEWS)
        let headers = `<tr><th>#</th><th>Buy Date</th><th>Call Date</th><th>CS Name</th><th>Customer Name</th><th>Phone</th>
        <th>Products</th><th>Total</th><th>Province</th>`;
        
        if (currentCRMFilter === 'all') {
            // Already added in base headers
        } else if (currentCRMFilter === 7) {
            headers += `<th>Detail</th><th>Link</th>`;
        } else if (currentCRMFilter === 30) {
            headers += `<th>Detail</th><th>Link</th>`;
        } else if (currentCRMFilter === 60) {
            headers += `<th>Detail</th><th>Link</th>`;
        }
        headers += `</tr>`;
        thead.innerHTML = headers;


        // 2. FILTER LOGIC
        const search = document.getElementById('crmSearch').value.toLowerCase();
        const today = new Date(); today.setHours(0,0,0,0);

        let displayData = allCRM.map(item => {
            let buyDate = parseDateObj(item.date);
            let targetDate = null;
            let daysDiff = 999;

            if(currentCRMFilter !== 'all') {
                targetDate = new Date(buyDate);
                targetDate.setDate(targetDate.getDate() + parseInt(currentCRMFilter));
                daysDiff = Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24));
            }
            return { ...item, targetDate, daysDiff, buyDateObj: buyDate };
        });

        const filtered = displayData.filter(t => {
            // Search Filter
            if(search && !JSON.stringify(t).toLowerCase().includes(search)) return false;
            
            // üî• Officer (Owner) Filter üî•
            if(ownerFilter !== 'all' && t.owner !== ownerFilter) return false;

            // üî• Content Check Logic (New v.0.5.34) üî•
            // Show only if there is a Link or Note (value is not '-')
            const hasData = (val) => val && String(val).trim() !== '-' && String(val).trim() !== '';

            if (currentCRMFilter === 7) {
                // Must have content in P or Q
                if (!hasData(t.colP) && !hasData(t.colQ)) return false;
            } else if (currentCRMFilter === 30) {
                // Must have content in U or V
                if (!hasData(t.colU) && !hasData(t.colV)) return false;
            } else if (currentCRMFilter === 60) {
                // Must have content in Z or AA
                if (!hasData(t.colZ) && !hasData(t.colAA)) return false;
            }

            return true;
        });

        // Sort
        filtered.sort((a,b) => {
            if (currentCRMFilter !== 'all') return (a.targetDate || 0) - (b.targetDate || 0);
            return (b.buyDateObj || 0) - (a.buyDateObj || 0);
        });

        document.getElementById('crm-total').innerText = filtered.length;

        if(filtered.length === 0) { tbody.innerHTML = `<tr><td colspan="9" style="text-align:center; padding:30px; opacity:0.5;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`; return; }

        if(filtered.length > crmLimit) {
            document.getElementById('crmLoadMoreBtn').style.display = 'inline-flex';
        } else {
            document.getElementById('crmLoadMoreBtn').style.display = 'none';
        }
        
        const itemsToShow = filtered.slice(0, crmLimit);

        itemsToShow.forEach((t, i) => {
            let callDateDisplay = "-";
            if (currentCRMFilter !== 'all' && t.targetDate) {
                 const dateStr = formatDate(t.targetDate);
                 callDateDisplay = `<span style="color:var(--text-secondary);">${dateStr}</span>`;
            }

            let rowHtml = `<tr>
                <td>${i+1}</td>
                <td>${t.date}</td>
                <td>${callDateDisplay}</td>
                <td><span class="status-badge status-assigned">${t.owner}</span></td>
                <td style="font-weight:600; color:var(--primary-color); cursor:pointer;" onclick="copyText('${t.name}')">${t.name}</td>
                <td style="cursor:pointer;" onclick="copyText('${t.phone}')">${t.phone}</td>
                <td style="font-size:11px;">${t.items}</td>
                <td style="text-align:right;">${t.total}</td>
                <td>${t.province}</td>`;

            // DYNAMIC COLUMNS
            if (currentCRMFilter === 'all') {
                // Already added base columns
            } else if (currentCRMFilter === 7) {
                rowHtml += `<td>${formatLink(t.colP)}</td><td>${formatLink(t.colQ)}</td>`;
            } else if (currentCRMFilter === 30) {
                rowHtml += `<td>${formatLink(t.colU)}</td><td>${formatLink(t.colV)}</td>`;
            } else if (currentCRMFilter === 60) {
                rowHtml += `<td>${formatLink(t.colZ)}</td><td>${formatLink(t.colAA)}</td>`;
            }

            rowHtml += `</tr>`;
            tbody.innerHTML += rowHtml;
        });
    }

    // üè† ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πâ‡∏≤ Home ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞
    function updateHome() {
        const todayObj = new Date();
        const todayStr = `${todayObj.getFullYear()}-${String(todayObj.getMonth()+1).padStart(2,'0')}-${String(todayObj.getDate()).padStart(2,'0')}`;
        const currentMonthStr = `${todayObj.getFullYear()}-${String(todayObj.getMonth()+1).padStart(2,'0')}`;

        // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (‡πÄ‡∏≠‡∏≤ Friend ‡∏≠‡∏≠‡∏Å ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á)
        const team = { 
            'Best':   { monthCases: 0, activeCases: 0, todayTotal: 0, todayClosed: 0 }, 
            'Ball':   { monthCases: 0, activeCases: 0, todayTotal: 0, todayClosed: 0 }, 
            'Ohm':    { monthCases: 0, activeCases: 0, todayTotal: 0, todayClosed: 0 }, 
            'Tar':    { monthCases: 0, activeCases: 0, todayTotal: 0, todayClosed: 0 } 
        };

        let urgentHtml = "";

        allTickets.forEach(t => {
            const owner = t.owner;
            const dateStr = parseDate(t.date);
            const isClosed = t.status.includes('‡∏õ‡∏¥‡∏î');
            const isUrgent = t.urgent.includes('1') || t.urgent.includes('2') || t.urgent.includes('‡∏û‡∏¥‡πÄ‡∏®‡∏©');

            // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• KPI
            if (team[owner]) {
                // ‡∏ô‡∏±‡∏ö‡πÄ‡∏Ñ‡∏™‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
                if (dateStr.startsWith(currentMonthStr)) {
                    team[owner].monthCases++;
                }
                
                // ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ñ‡∏™‡∏Ñ‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
                if (!isClosed) {
                    team[owner].activeCases++;
                }

                // ‡∏ô‡∏±‡∏ö‡πÄ‡∏Ñ‡∏™‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤ % ‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™
                if (dateStr === todayStr) {
                    team[owner].todayTotal++;
                    if (isClosed) {
                        team[owner].todayClosed++;
                    }
                }
            }

            // 2. ‡∏î‡∏∂‡∏á‡πÄ‡∏Ñ‡∏™‡∏î‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å ‡πÅ‡∏•‡∏∞‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà (‡πÑ‡∏°‡πà‡∏ô‡∏±‡∏ö‡∏≠‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß) ‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
            if (!isClosed && isUrgent) {
                const uCol = t.urgent.includes('1') ? '#ef4444' : '#f59e0b';
                let sClass = t.status.includes('‡∏Å‡∏≥‡∏•‡∏±‡∏á') ? 'status-doing' : (t.status.includes('‡∏°‡∏≠‡∏ö') ? 'status-assigned' : 'status-pending');

                // ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πâ‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Dashboard ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Ticket ID ‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                // * ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÉ‡∏´‡πâ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡πÇ‡∏´‡∏°‡∏î Light/Dark ‡πÑ‡∏î‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                urgentHtml += `<tr style="cursor:pointer;" onclick="switchPage('dashboard', document.querySelector('.dropdown-trigger')); document.getElementById('searchInput').value='${t.id}'; renderTable();">
                    <td style="font-weight:600; color:var(--primary-color)">${t.id}</td>
                    <td style="font-weight:500; color:var(--text-main);">${t.customer}</td>
                    <td style="color:var(--text-main);">${t.issue}</td>
                    <td><span class="urgent-badge" style="background:${uCol}"></span><span style="color:var(--text-main);">${t.urgent.split('.')[1]||t.urgent}</span></td>
                    <td><span class="status-badge" style="border: 1px solid var(--card-border); color:var(--text-main); background: transparent;">${t.owner}</span></td>
                    <td><span class="status-badge ${sClass}">${t.status}</span></td>
                </tr>`;
            }
        });

        // ‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÑ‡∏õ‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô KPI Card
        const kpiContainer = document.getElementById('home-kpis');
        kpiContainer.innerHTML = '';
        
        // ‡∏ä‡∏∏‡∏î‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÇ‡∏î‡∏î‡πÄ‡∏î‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
        const themeColors = ['var(--danger)', 'var(--info)', 'var(--success)', 'var(--warning)'];
        let colorIndex = 0;

        for(const [name, s] of Object.entries(team)) {
            const todayPct = s.todayTotal ? Math.round((s.todayClosed / s.todayTotal) * 100) : 0;
            const nameColor = themeColors[colorIndex % 4];
            
            // * ‡∏ô‡∏≥ bg-gradient ‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ Card ‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏ï‡∏≤‡∏° Light/Dark ‡πÑ‡∏î‡πâ‡πÄ‡∏≠‡∏á
            // * ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ä‡∏∑‡πà‡∏≠ (h3) ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô 24px ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡∏à‡∏≤‡∏Å themeColors
            kpiContainer.innerHTML += `
            <div class="stat-item" style="text-align:left; padding:15px; display:flex; flex-direction:column; gap:8px;">
                <h3 style="margin:0; font-size:24px; font-weight:700; color:${nameColor}; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">${name}</h3>
                <div style="font-size:12px; color:var(--text-secondary);">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ: <strong style="font-size:16px; color:var(--text-main);">${s.monthCases}</strong> ‡πÄ‡∏Ñ‡∏™</div>
                <div style="font-size:12px; color:var(--text-secondary);">‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á (Active): <strong style="font-size:16px; color:var(--text-main);">${s.activeCases}</strong></div>
                <div style="font-size:12px; color:var(--text-secondary);">‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: <strong style="font-size:16px; color:var(--text-main);">${todayPct}%</strong> (${s.todayClosed}/${s.todayTotal})</div>
            </div>`;
            colorIndex++;
        }

        // ‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á Urgent
        const urgentBody = document.getElementById('homeUrgentBody');
        if(urgentHtml === "") {
            urgentBody.innerHTML = `<tr><td colspan="6" style="text-align:center; opacity:0.5; padding:30px; color:var(--text-main);">üéâ ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏Ñ‡∏™‡∏î‡πà‡∏ß‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏•‡∏¢</td></tr>`;
        } else {
            urgentBody.innerHTML = urgentHtml;
        }
    }

    function updateDashboard() {
        const stats = { total:0, active:0, pending:0, doing:0, closed:0, special:0 };
        const team = { 'Best':{t:0,c:0}, 'Friend':{t:0,c:0}, 'Ball':{t:0,c:0}, 'Ohm':{t:0,c:0}, 'Tar':{t:0,c:0} };
        let tickerText = "";
        
        allTickets.forEach(t => {
            const isClosed = t.status.includes('‡∏õ‡∏¥‡∏î');
            stats.total++;
            if(isClosed) stats.closed++;
            else {
                stats.active++;
                if(t.status.includes('‡∏£‡∏≠')) stats.pending++; else stats.doing++;
            }
            if(t.status.includes('‡∏û‡∏¥‡πÄ‡∏®‡∏©')) stats.special++;

            if(team[t.owner]) { team[t.owner].t++; if(isClosed) team[t.owner].c++; }
            if(t.urgent.includes('1') && !isClosed) tickerText += `üî• [${t.id}] ${t.customer} (${t.issue}) &nbsp;&nbsp;&nbsp; `;
        });

        document.getElementById('val-total').innerText = stats.total;
        document.getElementById('val-active').innerText = stats.active;
        document.getElementById('val-pending').innerText = stats.pending;
        document.getElementById('val-doing').innerText = stats.doing;
        document.getElementById('val-closed').innerText = stats.closed;
        document.getElementById('val-special').innerText = stats.special;

        if(tickerText) { 
            document.getElementById('urgentTicker').style.display = 'flex'; 
            document.getElementById('tickerContent').innerHTML = tickerText; 
        } else {
            document.getElementById('urgentTicker').style.display = 'none';
        }

        const lb = document.getElementById('leaderboard'); lb.innerHTML = '';
        let i = 1;
        for(const [name, s] of Object.entries(team)) {
            const pct = s.t ? Math.round((s.c/s.t)*100) : 0;
            lb.innerHTML += `
            <div class="lb-card bg-gradient-${i}" onclick="document.getElementById('csFilter').value='${name}';renderTable()">
                <h3>${name}</h3>
                <div class="count">${s.t}</div>
                <div class="progress-track"><div class="progress-fill" style="width:${pct}%"></div></div>
                <div class="progress-label">${pct}% Closed</div>
            </div>`; 
            i++;
        }
    }

    function parseDate(str) {
        if (!str || str === '-' || str === '') return '';
        str = String(str).trim(); 
        let d, m, y;
        if (str.toLowerCase().startsWith('date(')) {
            const nums = str.match(/\d+/g);
            if (nums && nums.length >= 3) { y = parseInt(nums[0]); m = parseInt(nums[1]) + 1; d = parseInt(nums[2]); }
        } else {
            const datePart = str.split(' ')[0];
            const parts = datePart.split(/[\/\-\.]/);
            if (parts.length === 3) {
                if (parseInt(parts[0]) > 31) { y = parseInt(parts[0]); m = parseInt(parts[1]); d = parseInt(parts[2]); } 
                else { d = parseInt(parts[0]); m = parseInt(parts[1]); y = parseInt(parts[2]); }
            } else return '';
        }
        if (y > 2400) y -= 543;
        return `${y}-${String(m).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
    }

    function renderTable() {
        const tbody = document.getElementById('tableBody'); tbody.innerHTML = '';
        const search = document.getElementById('searchInput').value.toLowerCase();
        const sFilter = document.getElementById('statusFilter').value;
        const cFilter = document.getElementById('csFilter').value;
        const dFilter = document.getElementById('dateFilter').value;

        const filtered = allTickets.filter(t => {
            if(dFilter) { const rowDate = parseDate(t.date); if(rowDate !== dFilter) return false; }
            if(sFilter !== 'total-all') {
                if(sFilter === 'all' && t.status.includes('‡∏õ‡∏¥‡∏î')) return false;
                if(sFilter === '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' && !t.status.includes('‡∏£‡∏≠')) return false;
                if(sFilter === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' && !t.status.includes('‡∏Å‡∏≥‡∏•‡∏±‡∏á') && !t.status.includes('‡∏°‡∏≠‡∏ö')) return false;
                if(sFilter === '‡∏õ‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™' && !t.status.includes('‡∏õ‡∏¥‡∏î')) return false;
                if(sFilter === '‡∏û‡∏¥‡πÄ‡∏®‡∏©' && !t.status.includes('‡∏û‡∏¥‡πÄ‡∏®‡∏©')) return false;
            }
            if(cFilter !== 'all' && t.owner !== cFilter) return false;
            if(search && !JSON.stringify(t).toLowerCase().includes(search)) return false;
            return true;
        });
        filteredExport = filtered; 
        if(filtered.length === 0) { tbody.innerHTML = `<tr><td colspan="11" style="text-align:center; padding:30px; opacity:0.5;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`; return; }

        filtered.forEach((t, i) => {
            const uCol = t.urgent.includes('1') ? '#ef4444' : ((t.urgent.includes('2') || t.urgent.includes('‡∏û‡∏¥‡πÄ‡∏®‡∏©')) ? '#f59e0b' : '#3b82f6');
            let sClass = 'status-pending'; 
            if(t.status.includes('‡∏õ‡∏¥‡∏î')) sClass = 'status-closed'; 
            else if(t.status.includes('‡∏Å‡∏≥‡∏•‡∏±‡∏á')) sClass = 'status-doing'; 
            else if(t.status.includes('‡∏°‡∏≠‡∏ö')) sClass = 'status-assigned';

            tbody.innerHTML += `<tr>
                <td>${i+1}</td><td style="font-weight:600; color:var(--primary-color)">${t.id}</td><td>${t.date}</td> 
                <td style="font-weight:600;"><span class="click-to-copy" onclick="copyText(this.innerText)">${t.customer}</span></td>
                <td><div>${t.model}</div><small style="opacity:0.6">${t.type}</small></td>
                <td>${t.issue}</td><td>${t.solution}</td><td>${t.owner}</td>
                <td><span class="urgent-badge" style="background:${uCol}"></span>${t.urgent.split('.')[1]||t.urgent}</td>
                <td><span class="status-badge ${sClass}">${t.status}</span></td><td>${t.assignee}</td>
            </tr>`;
        });
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Render ‡∏•‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á Install Q+ ‡∏ó‡∏±‡πâ‡∏á 4 ‡∏Å‡∏•‡πà‡∏≠‡∏á
    function renderInstall() {
        const runningBody = document.querySelector('#installRunningTable tbody');
        const confirmBody = document.querySelector('#installConfirmTable tbody');
        const bookingBody = document.querySelector('#installBookingTable tbody');
        const availableBody = document.querySelector('#installAvailableTable tbody');

        if(!runningBody) return;

        runningBody.innerHTML = '';
        confirmBody.innerHTML = '';
        bookingBody.innerHTML = '';
        availableBody.innerHTML = '';

        const dateFilter = document.getElementById('installDateFilter').value;
        const search = document.getElementById('installSearch').value.toLowerCase();
        const teamFilter = document.getElementById('installTeamFilter').value;

        // ‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        const filtered = allInstalls.filter(t => {
            if (dateFilter) { 
                const rowDate = parseDate(t.date); 
                if (rowDate !== dateFilter) return false; 
            }
            if (teamFilter !== 'all' && t.team && !t.team.includes(teamFilter.split(' ')[0])) return false;
            if (search && !JSON.stringify(t).toLowerCase().includes(search)) return false;
            return true;
        });

        let cRunning = 0, cConfirm = 0, cBooking = 0, cAvail = 0;
        let runningJobsForMap = []; // üó∫Ô∏è ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà

        filtered.forEach(t => {
            const s = String(t.status).toLowerCase();
            let tr = `<tr>
                <td>${t.date}</td>
                <td style="font-weight:600; color:var(--text-main);">${t.customer}</td>
                <td>${formatLink(t.location)}</td> <td>${t.task}</td>
                <td>${t.mainProduct}</td>
                <td>${t.waterFilter}</td>
                <td>${t.team}</td>
                <td>${t.operator}</td>`;

            // ‡πÅ‡∏¢‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏õ‡πä‡∏∞‡πÜ
            if (s.includes('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£')) {
                tr += `<td><span class="status-badge status-doing" style="color: #ff4d4d; background: rgba(255, 77, 77, 0.1); border-color: rgba(255, 77, 77, 0.2);">${t.status}</span></td></tr>`;
                runningBody.innerHTML += tr;
                cRunning++;
                runningJobsForMap.push(t); // üó∫Ô∏è ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á Array ‡∏£‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
            } 
            else if (s.includes('comfirm') || s.includes('confirm') || s.includes('‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏°')) {
                tr += `<td><span class="status-badge status-closed">${t.status}</span></td></tr>`;
                confirmBody.innerHTML += tr;
                cConfirm++;
            } 
            else if (s.includes('‡∏à‡∏≠‡∏á')) {
                tr += `<td><span class="status-badge status-assigned">${t.status}</span></td></tr>`;
                bookingBody.innerHTML += tr;
                cBooking++;
            } 
            else if (s.includes('‡∏ß‡πà‡∏≤‡∏á')) {
                // ‡∏Ñ‡∏¥‡∏ß‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ä‡πâ 9 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢
                let trAvail = `<tr>
                    <td>${t.date}</td>
                    <td style="color:var(--text-secondary);">${t.customer !== '-' ? t.customer : '‡∏£‡∏≠‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</td>
                    <td>${formatLink(t.location)}</td> <td>${t.task}</td>
                    <td>${t.mainProduct}</td>
                    <td>${t.waterFilter}</td>
                    <td>${t.team}</td>
                    <td>${t.operator}</td>
                    <td><span class="status-badge status-pending">${t.status}</span></td></tr>`;
                availableBody.innerHTML += trAvail;
                cAvail++;
            }
        });

        // ‡∏´‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÑ‡∏´‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡∏¢ ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        const emptyRow = (colspan) => `<tr><td colspan="${colspan}" style="text-align:center; padding:20px; color:var(--text-secondary);">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
        if (cRunning === 0) runningBody.innerHTML = emptyRow(9);
        if (cConfirm === 0) confirmBody.innerHTML = emptyRow(9);
        if (cBooking === 0) bookingBody.innerHTML = emptyRow(9);
        if (cAvail === 0) availableBody.innerHTML = emptyRow(9);

        // üó∫Ô∏è ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏¥‡∏ß‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏õ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î
        updateInstallMap(runningJobsForMap);
    }

    function drawChart(data) {
        if(typeof google === 'undefined' || !google.visualization) return;
        if(!document.getElementById('view-summary').classList.contains('active') && !document.getElementById('view-home').classList.contains('active')) return;
        
        const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
        const textStyle = { color: isDark ? '#94a3b8' : '#64748b', fontName:'Inter', fontSize:12 };
        const baseOpt = { backgroundColor: 'transparent', legend: { position: 'right', textStyle: textStyle }, chartArea: { left:10, top:20, width:'90%', height:'80%' }, pieSliceBorderColor: 'transparent', sliceVisibilityThreshold: 0 };

        // ================= ‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ CS SUMMARY =================
        if(document.getElementById('view-summary').classList.contains('active')) {
            const mCounts = {}; data.forEach(t => { if(t.model && t.model!=='-') mCounts[t.model] = (mCounts[t.model]||0)+1; });
            const mData = [['Model','Count']]; Object.entries(mCounts).sort((a,b)=>b[1]-a[1]).slice(0,10).forEach(x => mData.push(x));
            new google.visualization.PieChart(document.getElementById('chart_div')).draw(google.visualization.arrayToDataTable(mData), {...baseOpt, pieHole: 0.5});

            const tCounts = {}; data.forEach(t => { if(t.type && t.type!=='-') tCounts[t.type] = (tCounts[t.type]||0)+1; });
            const tData = [['Type','Count']]; Object.entries(tCounts).sort((a,b)=>b[1]-a[1]).slice(0,10).forEach(x => tData.push(x));
            new google.visualization.PieChart(document.getElementById('chart_type_div')).draw(google.visualization.arrayToDataTable(tData), {...baseOpt, pieHole: 0.5});

            const uCounts = {}; data.forEach(t => { if(t.urgent) { const label = t.urgent.split('.')[1] || t.urgent; uCounts[label] = (uCounts[label]||0)+1; } });
            const uData = [['Urgency','Count']]; Object.entries(uCounts).forEach(x => uData.push(x));
            new google.visualization.PieChart(document.getElementById('chart_urgent_div')).draw(google.visualization.arrayToDataTable(uData), {...baseOpt, pieHole: 0.5, colors: ['#ef4444', '#f59e0b', '#3b82f6']});

            const sCounts = {}; data.forEach(t => { const s = t.satisfaction || 'N/A'; sCounts[s] = (sCounts[s]||0)+1; });
            const sData = [['Rating','Count', { role: 'style' }]]; Object.entries(sCounts).sort().forEach(([k,v]) => sData.push([k, v, '#10b981']));
            new google.visualization.BarChart(document.getElementById('chart_csat_div')).draw(google.visualization.arrayToDataTable(sData), {...baseOpt, legend:'none', hAxis:{textStyle}, vAxis:{textStyle}});

            const csResp = { 'Best': {sum:0, count:0}, 'Friend': {sum:0, count:0}, 'Ball': {sum:0, count:0}, 'Ohm': {sum:0, count:0}, 'Tar': {sum:0, count:0} }; 
            data.forEach(t => { 
                const val = parseFloat(t.responseTime); const owner = t.owner;
                if(!isNaN(val) && owner && owner !== '-') { 
                    if(!csResp[owner]) csResp[owner] = { sum:0, count:0 }; 
                    csResp[owner].sum += val; csResp[owner].count++; 
                }
            });
            const rData = [['CS Name','Avg Minutes', { role: 'style' }]]; 
            Object.entries(csResp).forEach(([k,v]) => { rData.push([k, parseFloat((v.count?v.sum/v.count:0).toFixed(2)), '#3b82f6']); });
            if (rData.length === 1) rData.push(['No Data', 0, '#3b82f6']);
            new google.visualization.ColumnChart(document.getElementById('chart_resp_div')).draw(google.visualization.arrayToDataTable(rData), {...baseOpt, legend:'none', hAxis:{textStyle}, vAxis:{textStyle}});
        }

        // ================= ‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ HOME =================
        if(document.getElementById('view-home').classList.contains('active')) {
            
            // 1. ‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏°: ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÄ‡∏à‡∏≠‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (Top Issues)
            const issueCounts = {}; 
            data.forEach(t => { 
                if(t.issue && t.issue !== '-' && t.issue !== '') {
                    issueCounts[t.issue] = (issueCounts[t.issue]||0)+1; 
                }
            });
            const iData = [['Issue','Count']]; 
            // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Top 10 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ô‡πà‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
            Object.entries(issueCounts).sort((a,b)=>b[1]-a[1]).slice(0,10).forEach(x => iData.push(x));
            if(iData.length > 1) {
                new google.visualization.PieChart(document.getElementById('chart_home_issue_div')).draw(google.visualization.arrayToDataTable(iData), {...baseOpt, pieHole: 0.5});
            }

            // 2. ‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏™‡πâ‡∏ô: ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (Last 14 Active Days)
            const dateResp = {};
            data.forEach(t => {
                const dateStr = parseDate(t.date);
                const val = parseFloat(t.responseTime);
                if(dateStr && !isNaN(val)) {
                    if(!dateResp[dateStr]) dateResp[dateStr] = {sum:0, count:0};
                    dateResp[dateStr].sum += val;
                    dateResp[dateStr].count++;
                }
            });
            const lineData = [['Date', 'Avg Minutes']];
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏õ‡∏°‡∏≤‡∏Å ‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á‡πÅ‡∏Ñ‡πà 14 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö
            const sortedDates = Object.keys(dateResp).sort().slice(-14);
            sortedDates.forEach(d => {
                // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Format ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô DD/MM ‡πÄ‡∏ä‡πà‡∏ô 15/02
                const shortDate = d.substring(8,10) + "/" + d.substring(5,7);
                lineData.push([shortDate, parseFloat((dateResp[d].sum / dateResp[d].count).toFixed(2))]);
            });
            if(lineData.length > 1) {
                new google.visualization.LineChart(document.getElementById('chart_home_resp_div')).draw(google.visualization.arrayToDataTable(lineData), {
                    ...baseOpt, 
                    legend: 'none', 
                    curveType: 'function',
                    pointSize: 6,
                    lineWidth: 3,
                    hAxis: {textStyle, slantedText: false}, 
                    vAxis: {textStyle, minValue: 0},
                    colors: ['#f97316'] // ‡πÉ‡∏ä‡πâ‡∏™‡∏µ Primary Color
                });
            }
        }
    }

    function exportCSV() {
        let csv = "ID,Date,Customer,Model,Issue,Solution,Owner,Urgency,Status,Assignee\n";
        filteredExport.forEach(r => csv += `"${r.id}","${r.date}","${r.customer}","${r.model}","${r.issue}","${r.solution}","${r.owner}","${r.urgent}","${r.status}","${r.assignee}"\n`);
        const link = document.createElement("a"); link.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv;charset=utf-8;' })); link.download = "CS_Report.csv"; link.click();
    }

    document.getElementById('ticketForm').onsubmit = function(e) {
        e.preventDefault(); const btn = this.querySelector('button[type="submit"]'); btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å..."; btn.disabled = true;
        fetch(SCRIPT_URL, { method: 'POST', body: new URLSearchParams(new FormData(this)), mode: 'no-cors' }).then(() => location.reload());
    };

    // üî• Restore Last Page on Load
    const lastPage = localStorage.getItem('cs_last_page');
    if (lastPage) {
        const btn = document.querySelector(`button[onclick="switchPage('${lastPage}', this)"]`);
        if(btn) switchPage(lastPage, btn);
    }
</script>
</body>
</html>
